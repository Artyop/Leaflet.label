/*
	Leaflet.label, a plugin that adds labels to markers and vectors for Leaflet powered maps.
	(c) 2012-2013, Jacob Toye, Smartrak

	https://github.com/Leaflet/Leaflet.label
	http://leafletjs.com
	https://github.com/jacobtoye
*/
(function(){L.labelVersion="0.1.2-dev",L.Label=L.Popup.extend({options:{autoPan:!1,className:"",closePopupOnClick:!1,noHide:!1,offset:new L.Point(12,-15)},onAdd:function(e){this._map=e,this._pane=this._source instanceof L.Marker?e._panes.markerPane:e._panes.popupPane,this._container||this._initLayout(),this._updateContent();var t=e.options.fadeAnimation;t&&L.DomUtil.setOpacity(this._container,0),this._pane.appendChild(this._container),e.on("viewreset",this._updatePosition,this),this._animated&&e.on("zoomanim",this._zoomAnimation,this),this._update(),t&&L.DomUtil.setOpacity(this._container,1)},onRemove:function(e){this._pane.removeChild(this._container),L.Util.falseFn(this._container.offsetWidth),e.off({viewreset:this._updatePosition,zoomanim:this._zoomAnimation},this),e.options.fadeAnimation&&L.DomUtil.setOpacity(this._container,0),this._map=null},close:function(){var e=this._map;e&&(e._label=null,e.removeLayer(this))},updateZIndex:function(e){this._zIndex=e,this._container&&(this._container.style.zIndex=e)},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-label "+this.options.className+" leaflet-zoom-animated"),this.updateZIndex(this._zIndex)},_updateContent:function(){this._content&&"string"==typeof this._content&&(this._container.innerHTML=this._content)},_updateLayout:function(){},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},_setPosition:function(e){e=e.add(this.options.offset),L.DomUtil.setPosition(this._container,e)},_zoomAnimation:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)}}),L.Icon.Default.mergeOptions({labelAnchor:new L.Point(9,-20)}),L.Marker.mergeOptions({icon:new L.Icon.Default}),L.Marker.include({showLabel:function(){return this._label&&this._map&&(this._label.setLatLng(this._latlng),this._map.showLabel(this._label)),this},hideLabel:function(){return this._label&&this._label.close(),this},setLabelNoHide:function(e){this._labelNoHide!==e&&(this._labelNoHide=e,e?(this._removeLabelRevealHandlers(),this.showLabel()):(this._addLabelRevealHandlers(),this.hideLabel()))},bindLabel:function(e,t){var i=L.point(this.options.icon.options.labelAnchor)||new L.Point(0,0);return i=i.add(L.Label.prototype.options.offset),t&&t.offset&&(i=i.add(t.offset)),t=L.Util.extend({offset:i},t),this._labelNoHide=t.noHide,this._label||(this._labelNoHide||this._addLabelRevealHandlers(),this.on("remove",this.hideLabel,this).on("move",this._moveLabel,this),this._hasLabelHandlers=!0),this._label=new L.Label(t,this).setContent(e),this},unbindLabel:function(){return this._label&&(this.hideLabel(),this._label=null,this._hasLabelHandlers&&(this._labelNoHide||this._removeLabelRevealHandlers(),this.off("remove",this.hideLabel).off("move",this._moveLabel)),this._hasLabelHandlers=!1),this},updateLabelContent:function(e){this._label&&this._label.setContent(e)},_addLabelRevealHandlers:function(){this.on("mouseover",this.showLabel,this).on("mouseout",this.hideLabel,this),L.Browser.touch&&this.on("click",this.showLabel,this)},_removeLabelRevealHandlers:function(){this.off("mouseover",this.showLabel).off("mouseout",this.hideLabel).off("remove",this.hideLabel).off("move",this._moveLabel),L.Browser.touch&&this.off("click",this.showLabel)},_moveLabel:function(e){this._label.setLatLng(e.latlng)},_originalUpdateZIndex:L.Marker.prototype._updateZIndex,_updateZIndex:function(e){var t=this._zIndex+e;this._originalUpdateZIndex(e),this._label&&this._label.updateZIndex(t)}}),L.Path.include({bindLabel:function(e,t){return this._label&&this._label.options===t||(this._label=new L.Label(t,this)),this._label.setContent(e),this._showLabelAdded||(this.on("mouseover",this._showLabel,this).on("mousemove",this._moveLabel,this).on("mouseout remove",this._hideLabel,this),L.Browser.touch&&this.on("click",this._showLabel,this),this._showLabelAdded=!0),this},unbindLabel:function(){return this._label&&(this._hideLabel(),this._label=null,this._showLabelAdded=!1,this.off("mouseover",this._showLabel).off("mousemove",this._moveLabel).off("mouseout remove",this._hideLabel)),this},updateLabelContent:function(e){this._label&&this._label.setContent(e)},_showLabel:function(e){this._label.setLatLng(e.latlng),this._map.showLabel(this._label)},_moveLabel:function(e){this._label.setLatLng(e.latlng)},_hideLabel:function(){this._label.close()}}),L.Map.include({showLabel:function(e){return this._label=e,this.addLayer(e)}}),L.FeatureGroup.include({clearLayers:function(){return this.unbindLabel(),this.eachLayer(this.removeLayer,this),this},bindLabel:function(e,t){return this.invoke("bindLabel",e,t)},unbindLabel:function(){return this.invoke("unbindLabel")},updateLabelContent:function(e){this.invoke("updateLabelContent",e)}})})(this,document);